<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Health Structure Workload Analysis</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
      margin: 0; padding: 2rem;
      background: linear-gradient(135deg, #e0e7ff, #fdfbff);
      display: flex; justify-content: center; min-height: 100vh;
    }
    form {
      background: #fff;
      padding: 2.5rem 2rem;
      border-radius: 16px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.08);
      width: 100%; max-width: 820px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      text-align: center;
      color: #4b0082;
    }
    label {
      display: block;
      margin-top: 1.2rem;
      margin-bottom: 0.5rem;
      color: #333;
      font-weight: 500;
    }
    textarea, select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 0.7rem 1rem;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 1rem;
      transition: 0.2s ease;
    }
    textarea:focus, input:focus, select:focus {
      border-color: #7b5eea;
      outline: none;
      box-shadow: 0 0 0 2px rgba(123, 94, 234, 0.15);
    }

    .radio-group, .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .radio-group div, .checkbox-group div {
      position: relative;
    }

    .radio-group input,
    .checkbox-group input {
      position: absolute;
      opacity: 0;
    }

    .radio-group label,
    .checkbox-group label {
      display: inline-block;
      background: #f1f1f9;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .radio-group input:checked + label,
    .checkbox-group input:checked + label {
      background: #7b5eea;
      color: #fff;
    }

    .task-entry {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.8rem;
      align-items: center;
      animation: fadeIn 0.3s ease-in-out;
    }
    .task-entry input { flex: 1; }

    .remove-btn {
      background: crimson; color: white;
      border: none; padding: 0.4rem 0.8rem;
      border-radius: 6px; cursor: pointer;
      font-weight: bold;
    }
    .add-btn {
      background: #7b5eea; color: white;
      border: none; padding: 0.6rem 1rem;
      border-radius: 8px; margin-top: 0.5rem;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .add-btn:hover { background: #5e47c7; }

    button[type="submit"] {
      display: block;
      background: #00b894; color: white;
      padding: 0.9rem 2rem;
      font-size: 1rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin: 2rem auto 0;
      transition: background 0.3s ease;
    }
    button[type="submit"]:hover {
      background: #009b7b;
    }

    #totalLoadWarning {
      margin-top: -0.5rem;
      font-size: 0.9rem;
      color: red;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 600px) {
      .task-entry { flex-direction: column; align-items: stretch; }
      .remove-btn { width: 100%; }
    }
  </style>
</head>
<body>

<form id="assessmentForm">
  <h1>Health Structure Workload Analysis</h1>

  <!-- Q1 -->
  <label for="position">1. What is your position within PUI?</label>
  <select name="position" required>
    <option value="" disabled selected>Select your position</option>
    <option>Deputy Health Coordinator</option>
    <option>Pharmacist Specialist</option>
    <option>Health Information Management Specialist</option>
    <option>Quality Health Specialist</option>
    <option>Pharmacist</option>
    <option>Community Health Specialist</option>
    <option>HIS Officer Coo</option>
    <option>Senior Medical Specialist</option>
    <option>Medical Specialist</option>
    <option>Health PM</option>
    <option>DHPM</option>
    <option>HIS Officer Base</option>
    <option>HIS TL</option>
    <option>PHCC TM</option>
    <option>Community TM</option>
    <option>Quality Advisor</option>
    <option>Community Health Supervisor</option>
    <option>BCA Officer</option>
    <option>Midwife</option>
  </select>

  <!-- Q2 -->
  <label>2. How many years of experience do you have in this role?</label>
  <div class="radio-group">
    <div><input type="radio" id="exp1" name="experience" value="Less than 3 years" required><label for="exp1">Less than 3 years</label></div>
    <div><input type="radio" id="exp2" name="experience" value="3-6 years"><label for="exp2">3–6 years</label></div>
    <div><input type="radio" id="exp3" name="experience" value="6-10 years"><label for="exp3">6–10 years</label></div>
    <div><input type="radio" id="exp4" name="experience" value="More than 10 years"><label for="exp4">More than 10 years</label></div>
  </div>

  <!-- Q3 -->
  <label>3. Workload Distribution by Task</label>
  <p>Please list the tasks you perform and assign a percentage to each task according to the time they consume. The total should be 100%.</p>
  <div id="taskContainer"></div>
  <button type="button" class="add-btn" onclick="addTask()">+ Add Task</button>
  <p><strong>Total Load Must Be 100%</strong></p>
  <p id="totalLoadWarning"></p>

  <!-- Q4 -->
  <label>4. What are your suggestions to reduce the time on these tasks?</label>
  <textarea name="time_reduction_suggestions" rows="4" required></textarea>

  <!-- Q5 -->
  <label>5. Are you able to absorb additional tasks within your working hours time?</label>
  <div class="radio-group">
    <div><input type="radio" id="abs1" name="absorb_more" value="Yes" required><label for="abs1">Yes</label></div>
    <div><input type="radio" id="abs2" name="absorb_more" value="No"><label for="abs2">No</label></div>
  </div>

  <!-- Q6 -->
  <label>6. How do you see your role within the HR structure?</label>
  <div class="radio-group">
    <div><input type="radio" id="hr1" name="role_importance" value="Very essential" required><label for="hr1">Very essential</label></div>
    <div><input type="radio" id="hr2" name="role_importance" value="Not essential"><label for="hr2">Not essential</label></div>
    <div><input type="radio" id="hr3" name="role_importance" value="Can be improved"><label for="hr3">Can be improved</label></div>
    <div><input type="radio" id="hr4" name="role_importance" value="Other"><label for="hr4">Other</label></div>
  </div>

  <!-- Q7 -->
  <label>7. What are the main channels to report to for the same topic?</label>
  <textarea name="reporting_channels" rows="4" required></textarea>

  <!-- Q8 -->
  <label>8. How do you think the monitoring of the activities could be improved with less time spent?</label>
  <textarea name="monitoring_improvement" rows="4" required></textarea>

  <button type="submit">Submit</button>
</form>

<script>
  const taskContainer = document.getElementById('taskContainer');
  let taskIndex = 0;

  function addTask() {
    const div = document.createElement('div');
    div.className = 'task-entry';
    div.innerHTML = `
      <input type="text" name="task_name_${taskIndex}" placeholder="Task Name" required />
      <input type="number" name="task_load_${taskIndex}" placeholder="% Load" min="0" max="100" required oninput="validateTotalLoad()" />
      <button type="button" class="remove-btn" onclick="removeTask(this)">×</button>
    `;
    taskContainer.appendChild(div);
    taskIndex++;
  }

  function removeTask(button) {
    button.parentElement.remove();
    validateTotalLoad();
  }

  function validateTotalLoad() {
    const loads = taskContainer.querySelectorAll('input[type=number]');
    let total = 0;
    loads.forEach(input => total += Number(input.value));
    const warning = document.getElementById('totalLoadWarning');
    warning.textContent = (total !== 100) ? `Current total is ${total}%. It must be 100%.` : '';
  }

  document.getElementById('assessmentForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const loadInputs = taskContainer.querySelectorAll('input[type=number]');
  let totalLoad = 0;
  loadInputs.forEach(input => totalLoad += Number(input.value));
  if (totalLoad !== 100) {
    alert("The total workload must sum up to 100%");
    return;
  }

  const formData = new FormData(this);
  const data = {};
  for (let [key, value] of formData.entries()) {
    if (data[key]) {
      if (!Array.isArray(data[key])) data[key] = [data[key]];
      data[key].push(value);
    } else {
      data[key] = value;
    }
  }

  fetch("https://script.google.com/macros/s/AKfycbzgQLOXoz4V3xiaPpOQeYaDl2JqrIyH8KiVWnNQLaaGy5JCsZAFR1aYxrr9ER62gNLqYg/exec", {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  }).then(res => {
    if (res.ok) {
      alert("Form submitted successfully!");
      document.getElementById("assessmentForm").reset();
      taskContainer.innerHTML = '';
      document.getElementById("totalLoadWarning").textContent = '';
      taskIndex = 0;
    } else {
      alert("Submission failed. Please try again.");
    }
  }).catch(() => {
    alert("Error submitting form.");
  });
});
</script>

</body>
</html>
